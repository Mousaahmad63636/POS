<Window x:Class="QuickTechSystems.WPF.Views.BulkMainStockDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:QuickTechSystems.WPF.Views"
        xmlns:converters="clr-namespace:QuickTechSystems.WPF.Converters"
        Title="Bulk Add MainStock Items"
        Height="700" Width="1200"
        WindowStartupLocation="CenterOwner"
        WindowState="Maximized"
        Closed="Window_Closed">

    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:ByteArrayToImageSourceConverter x:Key="ByteArrayToImageConverter"/>
        <converters:FilePathToImageConverter x:Key="FilePathToImageConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:IntZeroToBoolConverter x:Key="IntZeroToBoolConverter"/>
        <converters:IndexConverter x:Key="IndexConverter"/>
        <converters:DecimalConverter x:Key="DecimalConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section with Controls -->
        <Border Grid.Row="0" 
                BorderBrush="#E0E0E0" 
                BorderThickness="1" 
                CornerRadius="5" 
                Margin="0,0,0,10" 
                Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Top Row: Action Buttons -->
                <StackPanel Grid.Row="0" 
                           Orientation="Horizontal" 
                           Margin="0,0,0,15">
                    <Button Content="Add Row" 
                            Command="{Binding AddRowCommand}" 
                            Width="120" 
                            Height="32"
                            Margin="0,0,10,0"
                            IsEnabled="{Binding AreRequiredFieldsFilled}"/>
                    <Button Content="Generate Barcodes" 
                            Command="{Binding GenerateAllBarcodesCommand}" 
                            Width="150" 
                            Height="32"
                            Margin="0,0,15,0"/>
                    <CheckBox Content="Auto-generate barcodes" 
                              IsChecked="{Binding GenerateBarcodesForNewItems}" 
                              VerticalAlignment="Center" 
                              Margin="0,0,20,0"/>
                    <CheckBox Content="Auto-sync to Products" 
                              IsChecked="{Binding AutoSyncToProducts}"
                              VerticalAlignment="Center"
                              ToolTip="Automatically create/update products when saving MainStock items"/>
                </StackPanel>

                <!-- Bottom Row: Bulk Selection Controls -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Bulk Category Selection -->
                    <StackPanel Grid.Column="0" 
                               Margin="0,0,15,0">
                        <TextBlock Text="Bulk Category *" 
                                  FontWeight="SemiBold" 
                                  Margin="0,0,0,8" 
                                  Foreground="#DC3545"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ComboBox Grid.Column="0" 
                                      ItemsSource="{Binding Categories}" 
                                      SelectedItem="{Binding SelectedBulkCategory, UpdateSourceTrigger=PropertyChanged}"
                                      DisplayMemberPath="Name"
                                      Height="32"
                                      BorderBrush="{Binding IsCategorySelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#ccc|#DC3545'}"/>
                            <Button Grid.Column="1" 
                                    Content="+" 
                                    Command="{Binding AddNewCategoryCommand}" 
                                    Width="32" 
                                    Height="32"
                                    Margin="5,0,0,0"/>
                            <Button Grid.Column="2" 
                                    Content="Apply" 
                                    Command="{Binding ApplyBulkCategoryCommand}" 
                                    Width="60" 
                                    Height="32"
                                    Margin="5,0,0,0"/>
                        </Grid>
                    </StackPanel>

                    <!-- Bulk Supplier Selection -->
                    <StackPanel Grid.Column="1" 
                               Margin="15,0">
                        <TextBlock Text="Bulk Supplier *" 
                                  FontWeight="SemiBold" 
                                  Margin="0,0,0,8" 
                                  Foreground="#DC3545"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ComboBox Grid.Column="0" 
                                      ItemsSource="{Binding Suppliers}" 
                                      SelectedItem="{Binding SelectedBulkSupplier, UpdateSourceTrigger=PropertyChanged}"
                                      DisplayMemberPath="Name"
                                      Height="32"
                                      BorderBrush="{Binding IsSupplierSelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#ccc|#DC3545'}"/>
                            <Button Grid.Column="1" 
                                    Content="+" 
                                    Command="{Binding AddNewSupplierCommand}" 
                                    Width="32" 
                                    Height="32"
                                    Margin="5,0,0,0"/>
                            <Button Grid.Column="2" 
                                    Content="Apply" 
                                    Command="{Binding ApplyBulkSupplierCommand}" 
                                    Width="60" 
                                    Height="32"
                                    Margin="5,0,0,0"/>
                        </Grid>
                    </StackPanel>

                    <!-- Bulk Invoice Selection -->
                    <StackPanel Grid.Column="2" 
                               Margin="15,0,0,0">
                        <TextBlock Text="Bulk Invoice *" 
                                  FontWeight="SemiBold" 
                                  Margin="0,0,0,8" 
                                  Foreground="#DC3545"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ComboBox Grid.Column="0" 
                                      ItemsSource="{Binding SupplierInvoices}" 
                                      SelectedItem="{Binding SelectedBulkInvoice, UpdateSourceTrigger=PropertyChanged}"
                                      Height="32"
                                      BorderBrush="{Binding IsInvoiceSelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#ccc|#DC3545'}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Run Text="{Binding InvoiceNumber}"/>
                                            <Run Text=" - "/>
                                            <Run Text="{Binding SupplierName}"/>
                                        </TextBlock>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Grid.Column="1" 
                                    Content="+" 
                                    Command="{Binding AddNewInvoiceCommand}" 
                                    Width="32" 
                                    Height="32"
                                    Margin="5,0,0,0"/>
                            <Button Grid.Column="2" 
                                    Content="Apply" 
                                    Command="{Binding ApplyBulkInvoiceCommand}" 
                                    Width="60" 
                                    Height="32"
                                    Margin="5,0,0,0"/>
                        </Grid>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Items List -->
                <ItemsControl ItemsSource="{Binding Items}" 
                             Visibility="{Binding AreRequiredFieldsFilled, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#E0E0E0" 
                                    BorderThickness="1" 
                                    CornerRadius="5" 
                                    Margin="0,0,0,15">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Item Header -->
                                    <Grid Grid.Row="0" 
                                          Background="#F8F9FA" 
                                          Height="45">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="50"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Index Number -->
                                        <Border Grid.Column="0" 
                                                Background="#DC3545" 
                                                CornerRadius="5,0,0,0">
                                            <TextBlock Text="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ContentPresenter}}, 
                                                             Converter={StaticResource IndexConverter}}" 
                                                       VerticalAlignment="Center" 
                                                       HorizontalAlignment="Center"
                                                       FontWeight="Bold" 
                                                       Foreground="White"
                                                       FontSize="14"/>
                                        </Border>

                                        <!-- Item Name -->
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding Name}" 
                                                  VerticalAlignment="Center" 
                                                  Margin="15,0" 
                                                  FontWeight="SemiBold"
                                                  FontSize="14"/>

                                        <!-- Category Selection -->
                                        <TextBlock Grid.Column="2" 
                                                  Text="Category:" 
                                                  VerticalAlignment="Center" 
                                                  Margin="10,0,8,0"/>
                                        <ComboBox Grid.Column="3" 
                                                 ItemsSource="{Binding DataContext.Categories, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                 DisplayMemberPath="Name"
                                                 SelectedValuePath="CategoryId"
                                                 SelectedValue="{Binding CategoryId, UpdateSourceTrigger=PropertyChanged}"
                                                 Height="28"
                                                 VerticalContentAlignment="Center"/>

                                        <!-- Supplier Selection -->
                                        <TextBlock Grid.Column="4" 
                                                  Text="Supplier:" 
                                                  VerticalAlignment="Center" 
                                                  Margin="15,0,8,0"/>
                                        <ComboBox Grid.Column="5"
                                                 ItemsSource="{Binding DataContext.Suppliers, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                 DisplayMemberPath="Name"
                                                 SelectedValuePath="SupplierId"
                                                 SelectedValue="{Binding SupplierId, UpdateSourceTrigger=PropertyChanged}"
                                                 Height="28"
                                                 VerticalContentAlignment="Center"/>

                                        <!-- Remove Button -->
                                        <Button Grid.Column="6" 
                                               Content="×" 
                                               Command="{Binding DataContext.RemoveRowCommand, 
                                                        RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                               CommandParameter="{Binding}"
                                               Width="35" 
                                               Height="35" 
                                               Margin="15,0,10,0"
                                               Background="Transparent"
                                               BorderBrush="#FF6B6B"
                                               Foreground="#FF6B6B"
                                               FontWeight="Bold"
                                               FontSize="18"
                                               ToolTip="Remove this item"/>
                                    </Grid>

                                    <!-- Item Details -->
                                    <Grid Grid.Row="1" 
                                          Margin="15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Basic Information Section -->
                                        <Border Grid.Column="0" 
                                                BorderBrush="#E0E0E0" 
                                                BorderThickness="1" 
                                                CornerRadius="5" 
                                                Margin="0,0,8,0">
                                            <Grid Margin="12">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>

                                                <!-- Section Header -->
                                                <Border Grid.Row="0" 
                                                        Background="#198754"
                                                        CornerRadius="3"
                                                        Padding="8,6"
                                                        Margin="0,0,0,12">
                                                    <TextBlock Text="Basic Information" 
                                                              FontWeight="SemiBold" 
                                                              Foreground="White" 
                                                              HorizontalAlignment="Center"
                                                              FontSize="12"/>
                                                </Border>

                                                <!-- Basic Fields -->
                                                <Grid Grid.Row="1">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                                              Text="Name:" 
                                                              Margin="0,0,8,8" 
                                                              VerticalAlignment="Center"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="0" Grid.Column="1" 
                                                             Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                                             Height="28" 
                                                             Margin="0,0,0,8"/>

                                                    <TextBlock Grid.Row="1" Grid.Column="0" 
                                                              Text="Individual Items:" 
                                                              Margin="0,0,8,8" 
                                                              VerticalAlignment="Center"
                                                              FontWeight="Medium"
                                                              Foreground="#DC3545"/>
                                                    <TextBox Grid.Row="1" Grid.Column="1" 
                                                             Text="{Binding IndividualItems, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="integer"
                                                             PreviewTextInput="IntegerTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             Height="28" 
                                                             Margin="0,0,0,8"/>

                                                    <TextBlock Grid.Row="2" Grid.Column="0" 
                                                              Text="# of Boxes:" 
                                                              Margin="0,0,8,8" 
                                                              VerticalAlignment="Center"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="2" Grid.Column="1" 
                                                             Text="{Binding NumberOfBoxes, UpdateSourceTrigger=PropertyChanged}" 
                                                             Height="28" 
                                                             Margin="0,0,0,8"
                                                             Tag="integer"
                                                             PreviewTextInput="IntegerTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"/>

                                                    <TextBlock Grid.Row="3" Grid.Column="0" 
                                                              Text="Items/Box:" 
                                                              Margin="0,0,8,8" 
                                                              VerticalAlignment="Center"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="3" Grid.Column="1" 
                                                             Text="{Binding ItemsPerBox, UpdateSourceTrigger=PropertyChanged}" 
                                                             Height="28" 
                                                             Margin="0,0,0,8"
                                                             Tag="integer"
                                                             PreviewTextInput="IntegerTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"/>

                                                    <TextBlock Grid.Row="4" Grid.Column="0" 
                                                              Text="Active:" 
                                                              Margin="0,0,8,0" 
                                                              VerticalAlignment="Center"
                                                              FontWeight="Medium"/>
                                                    <CheckBox Grid.Row="4" Grid.Column="1" 
                                                             IsChecked="{Binding IsActive, UpdateSourceTrigger=PropertyChanged}" 
                                                             VerticalAlignment="Center"/>
                                                </Grid>
                                            </Grid>
                                        </Border>

                                        <!-- Barcode Information Section -->
                                        <Border Grid.Column="1" 
                                                BorderBrush="#E0E0E0" 
                                                BorderThickness="1" 
                                                CornerRadius="5" 
                                                Margin="8,0">
                                            <Grid Margin="12">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>

                                                <!-- Section Header -->
                                                <Border Grid.Row="0" 
                                                        Background="#0D6EFD"
                                                        CornerRadius="3"
                                                        Padding="8,6"
                                                        Margin="0,0,0,12">
                                                    <TextBlock Text="Barcode Information" 
                                                              FontWeight="SemiBold" 
                                                              Foreground="White" 
                                                              HorizontalAlignment="Center"
                                                              FontSize="12"/>
                                                </Border>

                                                <!-- Barcode Fields -->
                                                <StackPanel Grid.Row="1">
                                                    <TextBlock Text="Item Barcode:" 
                                                              Margin="0,0,0,8"
                                                              FontWeight="Medium"/>
                                                    <TextBox Text="{Binding Barcode, UpdateSourceTrigger=PropertyChanged}" 
                                                             Height="28" 
                                                             Margin="0,0,0,12"
                                                             KeyDown="BarcodeTextBox_KeyDown"
                                                             LostFocus="Barcode_LostFocus"/>

                                                    <TextBlock Text="Box Barcode:" 
                                                              Margin="0,0,0,8"
                                                              FontWeight="Medium"/>
                                                    <TextBox Text="{Binding BoxBarcode, UpdateSourceTrigger=PropertyChanged}" 
                                                             Height="28" 
                                                             KeyDown="BoxBarcodeTextBox_KeyDown"
                                                             LostFocus="Barcode_LostFocus"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>

                                        <!-- Pricing Information Section -->
                                        <Border Grid.Column="2" 
                                                BorderBrush="#E0E0E0" 
                                                BorderThickness="1" 
                                                CornerRadius="5" 
                                                Margin="8,0,0,0">
                                            <Grid Margin="12">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>

                                                <!-- Section Header -->
                                                <Border Grid.Row="0" 
                                                        Background="#DC3545"
                                                        CornerRadius="3"
                                                        Padding="8,6"
                                                        Margin="0,0,0,12">
                                                    <TextBlock Text="Pricing Information" 
                                                              FontWeight="SemiBold" 
                                                              Foreground="White" 
                                                              HorizontalAlignment="Center"
                                                              FontSize="12"/>
                                                </Border>

                                                <!-- Pricing Fields -->
                                                <Grid Grid.Row="1">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Box Purchase Price -->
                                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                                              Text="Box Purchase:" 
                                                              Margin="0,0,4,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="1" Grid.Column="0" 
                                                             Text="{Binding BoxPurchasePrice, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="decimal"
                                                             PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             GotFocus="PriceTextBox_GotFocus"
                                                             LostFocus="PriceTextBox_LostFocus"
                                                             Height="28" 
                                                             Margin="0,0,4,8"/>

                                                    <!-- Item Purchase Price -->
                                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                                              Text="Item Purchase:" 
                                                              Margin="4,0,0,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="1" Grid.Column="1" 
                                                             Text="{Binding PurchasePrice, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" 
                                                             Height="28" 
                                                             Margin="4,0,0,8"
                                                             Tag="decimal"
                                                             PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             GotFocus="PriceTextBox_GotFocus"
                                                             LostFocus="PriceTextBox_LostFocus"/>

                                                    <!-- Box Wholesale Price -->
                                                    <TextBlock Grid.Row="2" Grid.Column="0" 
                                                              Text="Box Wholesale:" 
                                                              Margin="0,0,4,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="3" Grid.Column="0" 
                                                             Text="{Binding BoxWholesalePrice, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="decimal"
                                                             PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             GotFocus="PriceTextBox_GotFocus"
                                                             LostFocus="PriceTextBox_LostFocus"
                                                             Height="28" 
                                                             Margin="0,0,4,8"/>

                                                    <!-- Item Wholesale Price -->
                                                    <TextBlock Grid.Row="2" Grid.Column="1" 
                                                              Text="Item Wholesale:" 
                                                              Margin="4,0,0,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="3" Grid.Column="1" 
                                                             Text="{Binding WholesalePrice, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="decimal"
                                                             PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             GotFocus="PriceTextBox_GotFocus"
                                                             LostFocus="PriceTextBox_LostFocus"
                                                             Height="28" 
                                                             Margin="4,0,0,8"/>

                                                    <!-- Box Sale Price -->
                                                    <TextBlock Grid.Row="4" Grid.Column="0" 
                                                              Text="Box Sale:" 
                                                              Margin="0,0,4,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="5" Grid.Column="0" 
                                                             Text="{Binding BoxSalePrice, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="decimal"
                                                             PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             GotFocus="PriceTextBox_GotFocus"
                                                             LostFocus="PriceTextBox_LostFocus"
                                                             Height="28" 
                                                             Margin="0,0,4,8"/>

                                                    <!-- Item Sale Price -->
                                                    <TextBlock Grid.Row="4" Grid.Column="1" 
                                                              Text="Item Sale:" 
                                                              Margin="4,0,0,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="5" Grid.Column="1" 
                                                             Text="{Binding SalePrice, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="decimal"
                                                             PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             GotFocus="PriceTextBox_GotFocus"
                                                             LostFocus="PriceTextBox_LostFocus"
                                                             Height="28" 
                                                             Margin="4,0,0,8"/>

                                                    <!-- Minimum Stock -->
                                                    <TextBlock Grid.Row="6" Grid.Column="0" 
                                                              Text="Min Stock:" 
                                                              Margin="0,0,4,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="7" Grid.Column="0" 
                                                             Text="{Binding MinimumStock, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="integer"
                                                             PreviewTextInput="IntegerTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             Height="28" 
                                                             Margin="0,0,4,0"/>

                                                    <!-- Minimum Box Stock -->
                                                    <TextBlock Grid.Row="6" Grid.Column="1" 
                                                              Text="Min Boxes:" 
                                                              Margin="4,0,0,4"
                                                              FontWeight="Medium"/>
                                                    <TextBox Grid.Row="7" Grid.Column="1" 
                                                             Text="{Binding MinimumBoxStock, UpdateSourceTrigger=PropertyChanged}" 
                                                             Tag="integer"
                                                             PreviewTextInput="IntegerTextBox_PreviewTextInput"
                                                             DataObject.Pasting="NumericTextBox_Pasting"
                                                             Height="28" 
                                                             Margin="4,0,0,0"/>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Placeholder Message -->
                <TextBlock Text="Please select Category, Supplier, and Invoice above to start adding products." 
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center" 
                          FontSize="16" 
                          Foreground="#6C757D" 
                          FontWeight="Medium"
                          Margin="0,100,0,0"
                          Visibility="{Binding AreRequiredFieldsFilled, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer Section -->
        <Grid Grid.Row="2" 
              Margin="0,15,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Status Information -->
            <StackPanel Grid.Column="0" 
                       Orientation="Horizontal" 
                       VerticalAlignment="Center">
                <TextBlock Text="{Binding StatusMessage}" 
                          FontWeight="Medium"
                          VerticalAlignment="Center"/>
                <ProgressBar Width="250" 
                             Height="18" 
                             Margin="15,0,0,0" 
                             Visibility="{Binding IsSaving, Converter={StaticResource BooleanToVisibilityConverter}}"
                             Minimum="0" 
                             Maximum="{Binding TotalRows}" 
                             Value="{Binding CurrentRow}"
                             IsIndeterminate="{Binding TotalRows, Converter={StaticResource IntZeroToBoolConverter}}"/>
            </StackPanel>

            <!-- Action Buttons -->
            <StackPanel Grid.Column="1" 
                       Orientation="Horizontal">
                <Button Content="Clear All" 
                        Command="{Binding ClearAllCommand}" 
                        Width="100" 
                        Height="36"
                        Margin="0,0,10,0"
                        Background="#6C757D"
                        Foreground="White"
                        FontWeight="Medium"/>
                <Button Content="Cancel" 
                        Click="CancelButton_Click" 
                        Width="100" 
                        Height="36"
                        Margin="0,0,10,0"
                        Background="#DC3545"
                        Foreground="White"
                        FontWeight="Medium"/>
                <Button Content="Save All" 
                        Command="{Binding SaveAllCommand}" 
                        Width="100"
                        Height="36"
                        Background="#198754" 
                        Foreground="White" 
                        FontWeight="SemiBold"/>
            </StackPanel>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" 
                Grid.RowSpan="3" 
                Background="#80000000" 
                Visibility="{Binding IsSaving, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Background="White"
                    Margin="50"
                    Padding="30"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="Black" 
                                      Direction="315" 
                                      ShadowDepth="5" 
                                      Opacity="0.3" 
                                      BlurRadius="10"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="{Binding StatusMessage}" 
                               Foreground="#212529" 
                               FontSize="18" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,15"/>
                    <ProgressBar Width="350" 
                                 Height="24" 
                                 Minimum="0" 
                                 Maximum="{Binding TotalRows}" 
                                 Value="{Binding CurrentRow}"
                                 IsIndeterminate="{Binding TotalRows, Converter={StaticResource IntZeroToBoolConverter}}"/>
                    <TextBlock Foreground="#6C757D"
                               HorizontalAlignment="Center"
                               FontWeight="Medium"
                               Margin="0,15,0,0">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="Processing item {0} of {1}">
                                <Binding Path="CurrentRow"/>
                                <Binding Path="TotalRows"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window>