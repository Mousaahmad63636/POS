<UserControl x:Class="QuickTechSystems.WPF.Views.ProductView"
             x:Name="ProductViewControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:QuickTechSystems.WPF.Views"
             xmlns:converters="clr-namespace:QuickTechSystems.WPF.Converters"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="1000" d:DesignWidth="1600">

    <UserControl.Resources>
        <local:LowStockConverter x:Key="LowStockConverter"/>
        <local:ProductIdToTitleConverter x:Key="ProductIdToTitleConverter"/>
        <local:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        <local:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <local:DecimalConverter x:Key="DecimalConverter"/>
        <converters:StockStatusConverter x:Key="StockStatusConverter"/>
        <converters:StockStatusToColorConverter x:Key="StockStatusToColorConverter"/>
        <converters:EnumToStringConverter x:Key="EnumToStringConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>

        <Style x:Key="TabButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0,0,0,3"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="Margin" Value="0,0,2,0"/>
            <Setter Property="Foreground" Value="{StaticResource TextTertiaryBrush}"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="MinWidth" Value="140"/>
            <Setter Property="Height" Value="55"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ActiveTabButtonStyle" TargetType="Button" BasedOn="{StaticResource TabButtonStyle}">
            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
        </Style>

        <Style x:Key="FilterGroupStyle" TargetType="StackPanel">
            <Setter Property="Margin" Value="0,0,20,0"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>

        <Style x:Key="FilterLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <Style x:Key="FilterControlStyle" TargetType="Control">
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="{StaticResource ShadowColor}" 
                                      Direction="270" 
                                      ShadowDepth="4" 
                                      Opacity="0.15" 
                                      BlurRadius="12"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentDarkBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentDarkBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource PrimaryBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Style="{StaticResource CardBorderStyle}"
                Margin="0,0,0,16">
            <Grid Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="📦" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <TextBlock Text="{DynamicResource Product_Management}" 
                              FontSize="24" 
                              FontWeight="SemiBold" 
                              Foreground="{StaticResource TextPrimaryBrush}"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <Button Grid.Column="1" 
                        Content="{DynamicResource Product_AddProduct}" 
                        Command="{Binding AddProductCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Height="40" 
                        Margin="0,0,12,0"/>

                <Button Grid.Column="2" 
                        Content="{DynamicResource Product_RefreshButton}" 
                        Command="{Binding RefreshCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Height="40"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="400"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Products List -->
            <Grid Grid.Column="0" Margin="0,0,16,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Filters -->
                <Border Grid.Row="0" 
                        Style="{StaticResource CardBorderStyle}"
                        Margin="0,0,0,16">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                  VerticalScrollBarVisibility="Disabled"
                                  Margin="20">
                        <StackPanel Orientation="Horizontal">
                            <!-- Search -->
                            <StackPanel Style="{StaticResource FilterGroupStyle}" MinWidth="300">
                                <TextBlock Text="Search" Style="{StaticResource FilterLabelStyle}"/>
                                <Border BorderBrush="{StaticResource BorderBrush}" 
                                        BorderThickness="1" 
                                        CornerRadius="6" 
                                        Background="{StaticResource SurfaceBrush}"
                                        Height="36">
                                    <Grid>
                                        <TextBlock Text="🔍" 
                                                   VerticalAlignment="Center" 
                                                   Margin="12,0,0,0" 
                                                   FontSize="14" 
                                                   Foreground="{StaticResource TextTertiaryBrush}"/>
                                        <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="Transparent" BorderThickness="0" 
                                                 Margin="36,0,12,0" VerticalAlignment="Center" FontSize="14"/>
                                        <TextBlock Text="Search by name, barcode, category, supplier..." 
                                                   Margin="36,0,12,0" VerticalAlignment="Center"
                                                   Foreground="{StaticResource TextTertiaryBrush}" FontSize="14"
                                                   IsHitTestVisible="False"
                                                   Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                    </Grid>
                                </Border>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FilterGroupStyle}">
                                <TextBlock Text="Category" Style="{StaticResource FilterLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding Categories}"
                                          SelectedValuePath="CategoryId" DisplayMemberPath="Name"
                                          SelectedValue="{Binding SelectedCategoryId}"
                                          Style="{StaticResource FilterControlStyle}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FilterGroupStyle}">
                                <TextBlock Text="Supplier" Style="{StaticResource FilterLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding Suppliers}"
                                          SelectedValuePath="SupplierId" DisplayMemberPath="Name"
                                          SelectedValue="{Binding SelectedSupplierId}"
                                          Style="{StaticResource FilterControlStyle}"/>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FilterGroupStyle}">
                                <TextBlock Text="Stock Status" Style="{StaticResource FilterLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding StockStatusOptions}"
                                          SelectedItem="{Binding SelectedStockStatus}"
                                          Style="{StaticResource FilterControlStyle}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource StockStatusConverter}}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FilterGroupStyle}">
                                <TextBlock Text="Sort By" Style="{StaticResource FilterLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding SortOptionOptions}"
                                          SelectedItem="{Binding SelectedSortOption}"
                                          Style="{StaticResource FilterControlStyle}" MinWidth="120">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource EnumToStringConverter}}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FilterGroupStyle}">
                                <TextBlock Text="Order" Style="{StaticResource FilterLabelStyle}"/>
                                <ComboBox SelectedValue="{Binding SortDescending}" Style="{StaticResource FilterControlStyle}">
                                    <ComboBox.Items>
                                        <ComboBoxItem Content="Ascending">
                                            <ComboBoxItem.Tag>
                                                <sys:Boolean>False</sys:Boolean>
                                            </ComboBoxItem.Tag>
                                        </ComboBoxItem>
                                        <ComboBoxItem Content="Descending">
                                            <ComboBoxItem.Tag>
                                                <sys:Boolean>True</sys:Boolean>
                                            </ComboBoxItem.Tag>
                                        </ComboBoxItem>
                                    </ComboBox.Items>
                                    <ComboBox.SelectedValuePath>Tag</ComboBox.SelectedValuePath>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Style="{StaticResource FilterGroupStyle}">
                                <TextBlock Text="Per Page" Style="{StaticResource FilterLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding PageSizeOptions}"
                                          SelectedItem="{Binding PageSize}"
                                          Style="{StaticResource FilterControlStyle}" Width="80"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" Margin="0,0,0,2">
                                <Button Content="Clear Filters" 
                                        Command="{Binding ClearFiltersCommand}"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Height="36" Width="100" FontSize="13"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Products List -->
                <Border Grid.Row="1" 
                        Style="{StaticResource CardBorderStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- List Header -->
                        <Border Grid.Row="0" 
                                Background="{StaticResource HoverBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,0,0,1"
                                Padding="20,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" 
                                           Text="{DynamicResource Product_ProductsList}" 
                                           FontWeight="SemiBold" 
                                           FontSize="16"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <TextBlock Text="{Binding PagedResult.TotalCount, StringFormat='{}{0} items'}"
                                               FontSize="14" 
                                               Foreground="{StaticResource TextTertiaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,16,0"/>

                                    <Button Content="Export CSV" 
                                            Command="{Binding ExportToCsvCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Height="28" 
                                            Padding="12,4" 
                                            FontSize="12"
                                            Margin="0,0,8,0"/>

                                    <Button Content="Export Excel" 
                                            Command="{Binding ExportToExcelCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Height="28" 
                                            Padding="12,4" 
                                            FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Products ScrollViewer -->
                        <ScrollViewer Grid.Row="1" 
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="20,16">
                            <ItemsControl ItemsSource="{Binding PagedResult.Items}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource SurfaceBrush}"
                                                BorderBrush="{StaticResource BorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="6"
                                                Padding="16"
                                                Margin="0,0,0,12"
                                                Cursor="Hand">
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick" 
                                                              Command="{Binding DataContext.SelectProductCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                                            <Setter Property="BorderThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Grid Grid.Column="0">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <Grid Grid.Row="0" Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding Name}" 
                                                                   FontWeight="Medium" FontSize="16"
                                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                                   TextTrimming="CharacterEllipsis"/>
                                                        <Border Grid.Column="1" Background="#F3F4F6" 
                                                                CornerRadius="6" Padding="8,4" Margin="12,0,0,0"
                                                                Visibility="{Binding IsActive, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                                            <TextBlock Text="Inactive" FontSize="11" FontWeight="Medium"
                                                                       Foreground="#6B7280"/>
                                                        </Border>
                                                    </Grid>

                                                    <TextBlock Grid.Row="1" Margin="0,0,0,12" 
                                                               Foreground="{StaticResource TextTertiaryBrush}" FontSize="14">
                                                        <Run Text="{Binding Barcode}" FontFamily="Consolas"/>
                                                        <Run Text=" • "/>
                                                        <Run Text="{Binding CategoryName}"/>
                                                    </TextBlock>

                                                    <Grid Grid.Row="2">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                                                            <TextBlock Text="Stock: " FontSize="13" 
                                                                       Foreground="{StaticResource TextTertiaryBrush}"/>
                                                            <TextBlock Text="{Binding CurrentStock}" FontSize="13" FontWeight="Medium"
                                                                       Foreground="{Binding StockStatus, Converter={StaticResource StockStatusToColorConverter}}"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                            <TextBlock Text="Sale: " FontSize="13" 
                                                                       Foreground="{StaticResource TextTertiaryBrush}"/>
                                                            <TextBlock Text="{Binding SalePrice, StringFormat='${0:F2}'}" 
                                                                       FontSize="13" FontWeight="Medium"
                                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="20,0,0,0">
                                                    <Border Background="{Binding StockStatus, Converter={StaticResource StockStatusToColorConverter}}" 
                                                            CornerRadius="12" Padding="8,4" Margin="0,0,0,8">
                                                        <TextBlock Text="{Binding StockStatus, Converter={StaticResource StockStatusConverter}}" 
                                                                   FontSize="11" FontWeight="Medium" Foreground="White"/>
                                                    </Border>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Pagination -->
                <Border Grid.Row="2" 
                        Style="{StaticResource CardBorderStyle}"
                        Margin="0,16,0,0">
                    <Grid Margin="20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" VerticalAlignment="Center" FontSize="14" 
                                   Foreground="{StaticResource TextTertiaryBrush}">
                            <Run Text="Page"/>
                            <Run Text="{Binding CurrentPage}" FontWeight="Medium"/>
                            <Run Text="of"/>
                            <Run Text="{Binding PagedResult.TotalPages}" FontWeight="Medium"/>
                            <Run Text="•"/>
                            <Run Text="{Binding PagedResult.TotalCount}" FontWeight="Medium"/>
                            <Run Text="items"/>
                        </TextBlock>

                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="First" 
                                    Command="{Binding FirstPageCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Height="32" Padding="12,4" FontSize="13" Margin="0,0,8,0"/>
                            <Button Content="Previous" 
                                    Command="{Binding PreviousPageCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Height="32" Padding="12,4" FontSize="13" Margin="0,0,8,0"/>
                            <Button Content="Next" 
                                    Command="{Binding NextPageCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Height="32" Padding="12,4" FontSize="13" Margin="0,0,8,0"/>
                            <Button Content="Last" 
                                    Command="{Binding LastPageCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Height="32" Padding="12,4" FontSize="13"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Right Panel - Product Details -->
            <Border Grid.Column="1" 
                    Style="{StaticResource CardBorderStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0" 
                            Background="{StaticResource HoverBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="20,16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="{Binding SelectedProduct, Converter={StaticResource ProductIdToTitleConverter}}" 
                                       FontWeight="SemiBold" 
                                       FontSize="18"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="{DynamicResource Product_SaveButton}" 
                                        Command="{Binding SaveProductCommand}"
                                        Style="{StaticResource PrimaryButtonStyle}"
                                        Height="36" 
                                        Padding="16,8" 
                                        FontSize="13"
                                        Margin="0,0,8,0"/>

                                <Button Content="{DynamicResource Product_DeleteButton}" 
                                        Command="{Binding DeleteProductCommand}"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Height="36" 
                                        Padding="16,8" 
                                        FontSize="13"
                                        Foreground="#DC2626"
                                        BorderBrush="#DC2626"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Content -->
                    <ScrollViewer Grid.Row="1" 
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Padding="20">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Tab Headers -->
                            <Border Grid.Row="0" 
                                    BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="0,0,0,1"
                                    Margin="0,0,0,20">
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="BasicInfoTab" 
                                            Content="{DynamicResource Product_BasicInfoTab}" 
                                            Tag="BasicInfo" 
                                            Click="TabButton_Click"
                                            Style="{StaticResource ActiveTabButtonStyle}"/>
                                    <Button x:Name="PricingTab" 
                                            Content="{DynamicResource Product_PricingTab}" 
                                            Tag="Pricing" 
                                            Click="TabButton_Click"
                                            Style="{StaticResource TabButtonStyle}"/>
                                    <Button x:Name="InventoryTab" 
                                            Content="📊 Inventory" 
                                            Tag="Inventory" 
                                            Click="TabButton_Click"
                                            Style="{StaticResource TabButtonStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Tab Content -->
                            <Grid Grid.Row="1">
                                <!-- Basic Info Tab -->
                                <StackPanel x:Name="BasicInfoContent" Visibility="Visible">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,28">
                                            <TextBlock Text="Product Name *" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.Name, UpdateSourceTrigger=PropertyChanged}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,28">
                                            <TextBlock Text="{DynamicResource Product_BarcodeLabel}" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <Grid>
                                                <TextBox Text="{Binding SelectedProduct.Barcode, UpdateSourceTrigger=PropertyChanged}"
                                                         Padding="16" Height="55" FontSize="15"/>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,8,0">
                                                    <Button Content="🔍" 
                                                            Command="{Binding SearchMatchingProductsCommand}"
                                                            Style="{StaticResource SecondaryButtonStyle}"
                                                            Height="32" Width="32" Padding="0" FontSize="14" Margin="0,0,4,0"/>
                                                    <Button Content="📋" 
                                                            Command="{Binding GenerateBarcodeCommand}"
                                                            Style="{StaticResource SecondaryButtonStyle}"
                                                            Height="32" Width="32" Padding="0" FontSize="14"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,28"
                                                    Visibility="{Binding ShowMatchingProducts, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Border Background="{StaticResource ErrorLightBrush}" 
                                                    BorderBrush="{StaticResource ErrorBorderBrush}" 
                                                    BorderThickness="1" 
                                                    CornerRadius="6" 
                                                    Padding="16">
                                                <StackPanel>
                                                    <TextBlock Text="{DynamicResource Product_UpdatingExisting}" 
                                                               FontWeight="Medium" FontSize="15" 
                                                               Foreground="{StaticResource ErrorTextBrush}" 
                                                               Margin="0,0,0,12"/>

                                                    <ItemsControl ItemsSource="{Binding MatchingProducts}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Background="{StaticResource SurfaceBrush}" 
                                                                        BorderBrush="{StaticResource BorderBrush}" 
                                                                        BorderThickness="1" 
                                                                        CornerRadius="6" 
                                                                        Padding="12" 
                                                                        Margin="0,0,0,8" 
                                                                        Cursor="Hand">
                                                                    <Border.InputBindings>
                                                                        <MouseBinding MouseAction="LeftClick" 
                                                                                      Command="{Binding DataContext.SelectMatchingProductCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                                      CommandParameter="{Binding}"/>
                                                                    </Border.InputBindings>
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Style.Triggers>
                                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                                    <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                                                                                </Trigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <StackPanel>
                                                                        <TextBlock Text="{Binding Name}" FontWeight="Medium" FontSize="14"/>
                                                                        <TextBlock Text="{Binding Barcode}" FontSize="12" 
                                                                                   Foreground="{StaticResource TextTertiaryBrush}" 
                                                                                   FontFamily="Consolas"/>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="{DynamicResource Product_StockLevel}" FontSize="12" 
                                                                                       Foreground="{StaticResource TextTertiaryBrush}"/>
                                                                            <TextBlock Text="{Binding CurrentStock}" FontSize="12" FontWeight="Medium" 
                                                                                       Foreground="{StaticResource TextPrimaryBrush}" Margin="4,0,0,0"/>
                                                                        </StackPanel>
                                                                    </StackPanel>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>

                                                    <Button Content="Clear Selection" 
                                                            Command="{Binding ClearMatchingProductsCommand}"
                                                            Style="{StaticResource SecondaryButtonStyle}"
                                                            Height="32" Padding="12,4" FontSize="12" HorizontalAlignment="Right"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>

                                        <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,0,28">
                                            <TextBlock Text="Category" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <ComboBox ItemsSource="{Binding Categories}"
                                                      SelectedValuePath="CategoryId" DisplayMemberPath="Name"
                                                      SelectedValue="{Binding SelectedProduct.CategoryId}"
                                                      Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,0,0,28">
                                            <TextBlock Text="Supplier" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <ComboBox ItemsSource="{Binding Suppliers}"
                                                      SelectedValuePath="SupplierId" DisplayMemberPath="Name"
                                                      SelectedValue="{Binding SelectedProduct.SupplierId}"
                                                      Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,28">
                                            <TextBlock Text="{DynamicResource Product_SupplierInvoice}" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <ComboBox ItemsSource="{Binding SupplierInvoices}"
                                                      SelectedItem="{Binding SelectedSupplierInvoice}"
                                                      DisplayMemberPath="InvoiceNumber"
                                                      Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,28">
                                            <TextBlock Text="{DynamicResource Product_DescriptionLabel}" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.Description, UpdateSourceTrigger=PropertyChanged}"
                                                     Padding="16" Height="120" FontSize="15" TextWrapping="Wrap" AcceptsReturn="True"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                                <!-- Pricing Tab -->
                                <StackPanel x:Name="PricingContent" Visibility="Collapsed">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,28">
                                            <TextBlock Text="Purchase Price *" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.PurchasePrice, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalConverter}}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,28">
                                            <TextBlock Text="Sale Price *" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.SalePrice, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalConverter}}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,28">
                                            <Border Background="{StaticResource HoverBrush}" 
                                                    BorderBrush="{StaticResource BorderBrush}" 
                                                    BorderThickness="1" 
                                                    CornerRadius="6" 
                                                    Padding="16">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="Profit Margin" FontWeight="Medium" FontSize="13"
                                                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                                        <TextBlock Text="{Binding SelectedProduct.ProfitMargin, StringFormat='{}{0:F1}%'}" 
                                                                   FontSize="18" FontWeight="SemiBold"
                                                                   Foreground="{StaticResource SuccessBrush}"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="Profit Amount" FontWeight="Medium" FontSize="13"
                                                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                                        <TextBlock Text="{Binding SelectedProduct.ProfitAmount, StringFormat='${0:F2}'}" 
                                                                   FontSize="18" FontWeight="SemiBold"
                                                                   Foreground="{StaticResource SuccessBrush}"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                                <!-- Inventory Tab -->
                                <StackPanel x:Name="InventoryContent" Visibility="Collapsed">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="16"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,28">
                                            <TextBlock Text="Current Stock" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.CurrentStock, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalConverter}}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,28">
                                            <TextBlock Text="Minimum Stock" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.MinimumStock, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalConverter}}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,0,28">
                                            <TextBlock Text="Storehouse" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.Storehouse, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalConverter}}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,0,0,28">
                                            <TextBlock Text="Items per Box" FontWeight="Medium" FontSize="15"
                                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,10"/>
                                            <TextBox Text="{Binding SelectedProduct.ItemsPerBox, UpdateSourceTrigger=PropertyChanged}"
                                                     Padding="16" Height="55" FontSize="15"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                                            <CheckBox Content="{DynamicResource Product_ActiveProduct}" 
                                                      IsChecked="{Binding SelectedProduct.IsActive}"
                                                      FontWeight="Medium" FontSize="15"
                                                      Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>